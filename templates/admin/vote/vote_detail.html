{% extends "admin/change_form.html" %}
{% load static %}

{% block extrahead %}
{{ block.super }}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}

{% block after_related_objects %}
{{ block.super }}

<h3>Vote Distribution</h3>
<canvas id="voteChart" width="400" height="400"></canvas>

<script>
  const ctx = document.getElementById('voteChart').getContext('2d');
  const voteData = {{ vote_data|safe }};

  const labels = voteData.map(v => v.label);
  const data = voteData.map(v => v.count);

  new Chart(ctx, {
    type: 'pie',
    data: {
      labels: labels,
      datasets: [{
        label: 'Votes',
        data: data,
        backgroundColor: [
          '#ff6384', '#36a2eb', '#cc65fe', '#ffce56', '#4bc0c0', '#9966ff'
        ],
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: {
          position: 'bottom'
        }
      }
    }
  });
</script>
{% endblock %}
